<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Problem Set — SMC 2024</title>

  <!-- KaTeX for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>

  <!-- PDF.js to read the official UKMT SMC 2024 paper -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  </script>

  <style>
    :root{
      --bg:#0b0f14; --fg:#e6edf3; --muted:#9aa7b3;
      --card:#11161d; --line:#1b2430; --accent:#6aa3ff; --bar:#21b09e;
    }
    html,body{background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}

    /* Top bar like your screenshot */
    .bar{background:var(--bar); color:#031a15; font-weight:800; padding:14px 18px; font-size:20px;}
    .wrap{max-width:1000px; margin:0 auto; padding:12px 16px 40px;}
    .actions{color:var(--muted); font-size:14px; margin:10px 0 18px; display:flex; gap:14px; flex-wrap:wrap}
    .actions button{border:1px solid var(--line); background:#0f1520; color:var(--fg); padding:8px 10px; border-radius:10px; cursor:pointer}
    .actions button:hover{background:#111a2a}

    .panel{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; margin:14px 0}
    .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    input[type="number"],select{background:#0f1520; color:var(--fg); border:1px solid var(--line); border-radius:10px; padding:6px 8px}

    /* Problem list styling */
    .problem{padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:#0f1520; margin:12px 0}
    .ptitle{font-weight:800; letter-spacing:.02em}
    .meta{color:var(--muted); font-size:12px}
    .stem{margin-top:8px; line-height:1.55; font-size:17px}
    hr.sep{border:none; border-top:1px solid var(--line); margin:12px 0 0}

    @media print{
      .panel, .actions { display:none !important; }
      body{background:#fff; color:#000}
      .problem{border:none; background:#fff}
      .bar{background:#fff; color:#000; border-bottom:1px solid #000}
      a{color:#000; text-decoration:none}
    }
  </style>
</head>
<body>
  <div class="bar" id="titlebar">Problem Set — SMC 2024</div>
  <div class="wrap">
    <div class="actions">
      <button id="btnCopy">Copy problem list</button>
      <button id="btnPrint">Print this page</button>
      <span id="status" class="meta"></span>
    </div>

    <!-- Optional: subset controls -->
    <div class="panel">
      <div class="row">
        <label>Number of problems
          <input id="count" type="number" min="1" max="25" value="25">
        </label>
        <label>Difficulty mix
          <select id="mix">
            <option value="balanced">Balanced (E/M/H)</option>
            <option value="easy">Easy-leaning</option>
            <option value="hard">Hard-leaning</option>
            <option value="pureRandom">Pure random</option>
          </select>
        </label>
        <button id="btnGenerate">Generate subset</button>
        <button id="btnAll">Show all 25</button>
      </div>
      <div class="meta" style="margin-top:6px">
        Source: official UKMT SMC 2024 paper PDF. We restate problems here under your permission; no PDFs mirrored.
      </div>
    </div>

    <div id="list"></div>
  </div>

<script>
/* ---------- Helpers ---------- */
const $ = (s)=>document.querySelector(s);
const statusEl = $('#status');

function renderMathIn(el){
  if (!window.renderMathInElement) return;
  window.renderMathInElement(el, {
    delimiters: [
      {left:"$$", right:"$$", display:true},
      {left:"\\(", right:"\\)", display:false},
      {left:"$", right:"$", display:false}
    ]
  });
}

function diffBucket(num){ // heuristic for SMC: larger number → harder
  const d = num/25;
  return d < .34 ? 'E' : d < .67 ? 'M' : 'H';
}

function choose(list,k){
  const a = list.slice();
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a.slice(0, Math.min(k, a.length));
}

/* ---------- PDF loader for SMC 2024 ---------- */
const UKMT_SMC_2024 = "https://ukmt.org.uk/wp-content/uploads/2024/10/SMC-2024-Paper.pdf";
// Optional local fallback if CORS blocks (upload the PDF as assets/SMC-2024-Paper.pdf)
const LOCAL_FALLBACK = "assets/SMC-2024-Paper.pdf";

async function extractSMC2024(url){
  const pdf = await pdfjsLib.getDocument(url).promise;
  let raw = "";
  for (let p=1; p<=pdf.numPages; p++){
    const page = await pdf.getPage(p);
    const content = await page.getTextContent();
    raw += " " + content.items.map(it => it.str).join(" ");
  }
  // Normalize and force "\nN. " starts
  let text = raw
    .replace(/\u00A0/g," ")
    .replace(/\s+/g," ")
    .replace(/(\b[12]?\d)\s*\.\s/g, "\n$1. ");

  // Split into numbered blocks
  const blocks = [];
  const re = /(?:^|\n)(\d{1,2})\.\s([\s\S]*?)(?=\n\d{1,2}\.\s|$)/g;
  let m;
  while((m = re.exec(text))!==null){
    const n = +m[1];
    if (n<1 || n>25) continue;
    let body = m[2].trim();

    // Pull options A–E if present and format on separate lines
    const opt = /\sA\s(.+?)\sB\s(.+?)\sC\s(.+?)\sD\s(.+?)\sE\s(.+?)$/;
    let statement = body;
    const om = opt.exec(body);
    if (om){
      const stem = body.slice(0, om.index).trim();
      const [A,B,C,D,E] = om.slice(1).map(x=>x.trim());
      statement = `${stem}\n(A) ${A}\n(B) ${B}\n(C) ${C}\n(D) ${D}\n(E) ${E}`;
    }
    blocks.push({num:n, statement});
  }
  // Sort by number and map to our shape
  return blocks.sort((a,b)=>a.num-b.num).map(b => ({
    id: `SMC-2024-Q${b.num}`,
    source: "UKMT",
    contest: "SMC",
    year: 2024,
    num: b.num,
    kind: "mc",
    rights: "© UKMT, used with permission.",
    difficulty: diffBucket(b.num),
    statement: b.statement
  }));
}

async function loadSMC2024(){
  statusEl.textContent = "Loading SMC 2024 from UKMT…";
  try{
    let problems;
    try {
      problems = await extractSMC2024(UKMT_SMC_2024);
    } catch (corsOrNet){
      // try local fallback if present
      problems = await extractSMC2024(LOCAL_FALLBACK);
    }
    if (!problems.length) throw new Error("No problems parsed.");
    window._smc2024 = problems; // cache globally
    statusEl.textContent = "Loaded SMC 2024 ✓";
    return problems;
  }catch(e){
    console.error(e);
    statusEl.textContent = "SMC 2024 load failed: " + e.message;
    // Minimal seed so the page still works
    return [
      {id:"SMC-2024-Q1",source:"UKMT",contest:"SMC",year:2024,num:1,kind:"mc",
       rights:"© UKMT, used with permission.",
       difficulty:"E",
       statement:"(Seed) If $a+b=10$ and $ab=21$, find $a^2+b^2$. (A) 42 (B) 58 (C) 62 (D) 70 (E) 100"}
    ];
  }
}

/* ---------- Rendering ---------- */
function renderList(problems){
  const list = $('#list');
  const lines = problems.map((p,i)=>{
    const head = `
      <div class="ptitle">PROBLEM ${i+1} <span class="meta">(${p.year} ${p.contest} #${p.num})</span></div>
    `;
    const body = `
      <div class="stem" data-stem>${p.statement.replace(/\n/g,'<br>')}</div>
      <div class="meta" style="margin-top:8px">${p.rights||''}</div>
    `;
    return `<div class="problem">${head}${body}<hr class="sep"></div>`;
  }).join('');
  list.innerHTML = lines;
  renderMathIn(list);
  $('#titlebar').textContent = `Problem Set — SMC 2024 (${problems.length} problems)`;
}

function toPlainText(problems){
  const parts = problems.map((p,i)=>[
    `PROBLEM ${i+1} (${p.year} ${p.contest} #${p.num})`,
    p.statement
  ].join("\n"));
  return parts.join("\n\n---\n\n");
}

/* ---------- Subset generation (optional) ---------- */
function pickSubset(all, count, mix){
  if (mix==='pureRandom') return choose(all, count);
  const weights = {
    balanced:{E:.4,M:.4,H:.2},
    easy:{E:.6,M:.3,H:.1},
    hard:{E:.15,M:.45,H:.4}
  }[mix] || {E:.4,M:.4,H:.2};
  const by = {E:[],M:[],H:[]};
  all.forEach(p => by[p.difficulty || diffBucket(p.num)].push(p));
  const want = {
    E: Math.round(count*weights.E),
    M: Math.round(count*weights.M)
  };
  want.H = count - want.E - want.M;
  let out = [].concat(choose(by.E, want.E), choose(by.M, want.M), choose(by.H, want.H));
  if (out.length < count) out = out.concat(choose(all.filter(p=>!out.includes(p)), count - out.length));
  return out;
}

/* ---------- Wire-up ---------- */
(async function init(){
  const problems = await loadSMC2024();
  renderList(problems);

  $('#btnCopy').addEventListener('click', async ()=>{
    try { await navigator.clipboard.writeText(toPlainText(problems)); statusEl.textContent = "Copied list to clipboard ✓"; }
    catch(e){ statusEl.textContent = "Copy failed: " + e.message; }
  });
  $('#btnPrint').addEventListener('click', ()=>window.print());

  $('#btnAll').addEventListener('click', ()=>renderList(window._smc2024 || problems));
  $('#btnGenerate').addEventListener('click', ()=>{
    const n = Math.max(1, Math.min(25, +$('#count').value||25));
    const mix = $('#mix').value;
    const sub = pickSubset(window._smc2024 || problems, n, mix);
    renderList(sub);
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='p') return; // let print work
    if ((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='c'){ e.preventDefault(); $('#btnCopy').click(); }
  });
})();
</script>
</body>
</html>

