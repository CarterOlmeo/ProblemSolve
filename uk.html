<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Problem Archive — UKMT & Friends</title>

  <!-- KaTeX for math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>

  <style>
    :root{ --bg:#0b0f14; --fg:#e6edf3; --muted:#9aa7b3; --card:#11161d; --line:#1b2430; --accent:#6aa3ff; --bar:#21b09e; }
    html,body{background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    .bar{background:var(--bar); color:#031a15; font-weight:800; padding:14px 18px; font-size:20px;}
    .wrap{max-width:1000px; margin:0 auto; padding:12px 16px 40px;}
    .actions{color:var(--muted); font-size:14px; margin:10px 0 18px; display:flex; gap:14px; flex-wrap:wrap}
    .actions button{border:1px solid var(--line); background:#0f1520; color:#fff; padding:8px 10px; border-radius:10px; cursor:pointer}
    .actions button:hover{background:#111a2a}
    .panel{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; margin:14px 0}
    .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    input[type="number"],select{background:#0f1520; color:#fff; border:1px solid var(--line); border-radius:10px; padding:6px 8px}
    .problem{padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:#0f1520; margin:12px 0}
    .ptitle{font-weight:800; letter-spacing:.02em}
    .meta{color:var(--muted); font-size:12px}
    .stem{margin-top:8px; line-height:1.55; font-size:17px; white-space:pre-line}
    .options{margin:8px 0; padding-left:20px}
    .options li{margin:2px 0; line-height:1.4}
    .figure{text-align:center;margin:10px 0}
    .figure img{max-width:90%;border-radius:8px;border:1px solid var(--line)}
    hr.sep{border:none; border-top:1px solid var(--line); margin:12px 0 0}
    @media print{ .panel, .actions { display:none !important; } body{background:#fff; color:#000} .problem{border:none; background:#fff} .bar{background:#fff; color:#000; border-bottom:1px solid #000} a{color:#000; text-decoration:none} }
  </style>
</head>
<body>
  <div class="bar" id="titlebar">Problem Archive</div>
  <div class="wrap">
    <div class="actions">
      <button id="btnCopy">Copy problem list</button>
      <button id="btnPrint">Print this page</button>
      <span id="status" class="meta"></span>
    </div>

    <div class="panel">
      <div class="row">
        <label>Contest
          <select id="contest">
            <option value="smc-2024">SMC 2024</option>
            <option value="jmc-2015">JMC 2015</option>
            <option value="jmc-2016">JMC 2016</option>
            <option value="jmc-2017">JMC 2017</option>
            <option value="jmc-2018">JMC 2018</option>
            <option value="jmc-2019">JMC 2019</option>
            <option value="jmc-2020">JMC 2020</option>
            <option value="jmc-2021">JMC 2021</option>
            <option value="jmc-2022">JMC 2022</option>
            <option value="jmc-2023">JMC 2023</option>
            <option value="jmc-2024">JMC 2024</option>
            <option value="jmc-2025">JMC 2025</option>
            <option value="kangaroo-2025">Junior Kangaroo 2025</option>
            <option value="kangaroo-2024">Junior Kangaroo 2024</option>
            <option value="kangaroo-2023">Junior Kangaroo 2023</option>
            <option value="kangaroo-2022">Junior Kangaroo 2022</option>
            <option value="kangaroo-2021">Junior Kangaroo 2021</option>
            <option value="kangaroo-2020">Junior Kangaroo 2020</option>
            <option value="kangaroo-2019">Junior Kangaroo 2019</option>
            <option value="kangaroo-2018">Junior Kangaroo 2018</option>
            <option value="kangaroo-2017">Junior Kangaroo 2017</option>
            <option value="kangaroo-2016">Junior Kangaroo 2016</option>
            <option value="kangaroo-2015">Junior Kangaroo 2015</option>
            <option value="jo-2024">Junior Olympiad 2024</option>
          </select>
        </label>
        <label>Number of problems <input id="count" type="number" min="1" max="30" value="10"></label>
        <label>Difficulty mix
          <select id="mix">
            <option value="balanced">Balanced</option>
            <option value="easy">Easy-leaning</option>
            <option value="hard">Hard-leaning</option>
            <option value="pureRandom">Pure random</option>
          </select>
        </label>
        <button id="btnGenerate">Generate subset</button>
        <button id="btnAll">Show all</button>
      </div>
      <div class="meta" style="margin-top:6px">
        Source: UKMT and related contests (restated with permission). Data loaded from <code>assets/problems/*.json</code>.
      </div>
    </div>

    <div id="list"></div>
  </div>

<script>
const $ = (s)=>document.querySelector(s);
const statusEl = $('#status');

function renderMathIn(el){
  if (!window.renderMathInElement) return;
  window.renderMathInElement(el, {
    delimiters: [
      {left:"$$", right:"$$", display:true},
      {left:"\\(", right:"\\)", display:false},
      {left:"$", right:"$", display:false}
    ]
  });
}
function diffBucket(num){ const d=num/25; return d<.34?'E':d<.67?'M':'H'; }
function choose(list,k){ const a=list.slice(); for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a.slice(0,Math.min(k,a.length)); }

/* ---- Load JSON for contest ---- */
async function loadContest(contestFile){
  statusEl.textContent = `Loading ${contestFile}…`;
  try {
    const r = await fetch(`/ProblemSolve/assets/${contestFile}.json`, {cache:'no-store'});
    if (!r.ok) throw new Error("HTTP " + r.status);
    const arr = await r.json();
    const probs = arr.map(b => ({
      id: `${b.contest}-${b.year}-Q${b.num}`,
      source: "UKMT",
      ...b,
      rights: "© UKMT, used with permission.",
      difficulty: diffBucket(b.num),
      options: b.options || []
    }));
    window._currentProblems = probs;
    statusEl.textContent = `Loaded ✓ ${probs.length} problems from ${contestFile}`;
    return probs;
  } catch(e){
    console.error(e);
    statusEl.textContent = `Load failed for ${contestFile}`;
    return [];
  }
}

/* ---- Render ---- */
function renderList(problems){
  const list = $('#list');
  list.innerHTML = problems.map((p,i)=>`
    <div class="problem">
      <div class="ptitle">PROBLEM ${i+1} <span class="meta">(${p.year} ${p.contest} #${p.num})</span></div>
      <div class="stem">${p.statement.replace(/\n/g,'<br>')}</div>
      ${p.image ? `<div class="figure"><img src="${p.image}" alt="Problem ${p.num}" /></div>` : ''}
      <ul class="options">
        ${(p.options && p.options.length ? p.options.map((opt,j)=>`<li>(${String.fromCharCode(65+j)}) ${opt}</li>`).join('') : '<li><em>No options</em></li>')}
      </ul>
      <div class="meta" style="margin-top:8px">${p.rights||''}</div>
      <hr class="sep">
    </div>
  `).join('');
  renderMathIn(list);
  $('#titlebar').textContent = `Problem Archive (${problems.length} problems)`;
}

function toPlainText(problems){
  return problems.map((p,i)=>`PROBLEM ${i+1} (${p.year} ${p.contest} #${p.num})\n${p.statement}\nOptions: ${p.options.join(" | ")}`).join("\n\n---\n\n");
}

function pickSubset(all,count,mix){
  if(mix==='pureRandom') return choose(all,count).sort((a,b)=>a.num-b.num);
  const weights={balanced:{E:.4,M:.4,H:.2},easy:{E:.6,M:.3,H:.1},hard:{E:.15,M:.45,H:.4}}[mix]||{E:.4,M:.4,H:.2};
  const by={E:[],M:[],H:[]}; all.forEach(p=>by[p.difficulty||diffBucket(p.num)].push(p));
  const want={E:Math.round(count*weights.E), M:Math.round(count*weights.M)}; want.H=count-want.E-want.M;
  let out=[].concat(choose(by.E,want.E), choose(by.M,want.M), choose(by.H,want.H));
  if(out.length<count) out=out.concat(choose(all.filter(p=>!out.includes(p)), count-out.length));
  return out.sort((a,b)=>a.num-b.num);
}

/* ---- Init ---- */
(async function init(){
  const contestFile = $('#contest').value;
  const problems = await loadContest(contestFile);
  renderList(problems);

  $('#contest').addEventListener('change', async (e)=>{
    const probs = await loadContest(e.target.value);
    renderList(probs);
  });

  $('#btnCopy').addEventListener('click', async ()=>{ 
    try{ await navigator.clipboard.writeText(toPlainText(window._currentProblems||[])); statusEl.textContent="Copied ✓"; }
    catch(e){ statusEl.textContent="Copy failed: "+e.message; }
  });
  $('#btnPrint').addEventListener('click', ()=>window.print());
  $('#btnAll').addEventListener('click', ()=>renderList(window._currentProblems||[]));
  $('#btnGenerate').addEventListener('click', ()=>{ 
    const n=Math.max(1,Math.min(30,+$('#count').value||30)); 
    const mix=$('#mix').value; 
    renderList(pickSubset(window._currentProblems||[], n, mix)); 
  });
})();
</script>
</body>
</html>
