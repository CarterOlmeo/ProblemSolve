<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trivial — Random Set Generator (Inline Viewer)</title>
  <style>
    :root{--bg:#0b0f14;--fg:#e6edf3;--muted:#9aa7b3;--card:#11161d;--line:#1b2430;--accent:#6aa3ff}
    html,body{background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    header{padding:24px 16px;max-width:1100px;margin:0 auto}
    h1{margin:0 0 6px;letter-spacing:-.02em}
    .sub{color:var(--muted);font-size:14px}
    .wrap{max-width:1100px;margin:0 auto;padding:0 16px 24px}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{border:1px solid var(--line);background:#0f1520;color:var(--fg);padding:10px 12px;border-radius:12px;cursor:pointer}
    .btn:hover{background:#111a2a}
    input[type="number"],select{background:#0f1520;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:8px 10px}
    label{display:flex;gap:8px;align-items:center}
    .set{display:grid;gap:12px;margin:16px 0}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:12px}
    .pill{display:inline-flex;padding:2px 8px;border-radius:999px;background:#101827;color:#cbd5e1;font-size:12px;border:1px solid var(--line);margin-left:6px}
    .meta{color:var(--muted);font-size:12px}
    .footer{color:var(--muted);font-size:12px;margin-top:10px}
    .right{margin-left:auto}
    .danger{color:#f6c76f}
    .ctrls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .linkbox{background:#0f1520;border:1px dashed var(--line);border-radius:12px;padding:8px 10px;color:var(--muted);font-size:12px}

    /* Inline viewer */
    #viewer{display:grid;gap:10px}
    #viewer .head{display:flex;gap:10px;align-items:center}
    #stage{height:80vh;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0f1520;display:grid;place-items:center}
    #stage iframe{width:100%;height:100%;border:0;background:#0f1520}
    .note{color:var(--muted);font-size:12px}
  </style>
</head>
<body>
<header>
  <h1>Random Set Generator — Inline Viewer (UKMT & CRUX, link‑only)</h1>
  <div class="sub">Generate a set, then view each problem's <em>official PDF page</em> inline. We don't mirror any statements.
    <div class="danger">Permissions note: We store only metadata (contest, year, number, URLs). If a PDF blocks embedding, use "Open PDF".</div>
  </div>
</header>
<div class="wrap">
  <section class="panel">
    <div class="grid">
      <div>
        <label>Number of problems <input id="count" type="number" min="1" max="30" value="8"></label>
        <label>Difficulty mix
          <select id="mix">
            <option value="balanced">Balanced (E/M/H)</option>
            <option value="easy">Easy‑leaning</option>
            <option value="hard">Hard‑leaning</option>
            <option value="pureRandom">Pure random</option>
          </select>
        </label>
      </div>
      <div>
        <div class="sub" style="margin-bottom:6px">Sources</div>
        <label><input type="checkbox" class="src" value="UKMT" checked> UKMT (JMC/IMC/SMC/BMO)</label><br>
        <label><input type="checkbox" class="src" value="CRUX" checked> CRUX journal</label>
      </div>
      <div>
        <div class="sub" style="margin-bottom:6px">Contest types</div>
        <label><input type="checkbox" class="kind" value="mc" checked> Multiple‑choice</label>
        <label><input type="checkbox" class="kind" value="proof" checked> Proof</label>
      </div>
      <div>
        <div class="sub" style="margin-bottom:6px">Contest filters</div>
        <div class="row">
          <label><input type="checkbox" class="ct" value="JMC" checked> JMC</label>
          <label><input type="checkbox" class="ct" value="IMC" checked> IMC</label>
          <label><input type="checkbox" class="ct" value="SMC" checked> SMC</label>
          <label><input type="checkbox" class="ct" value="BMO1" checked> BMO1</label>
          <label><input type="checkbox" class="ct" value="BMO2"> BMO2</label>
          <label><input type="checkbox" class="ct" value="CRUX" checked> CRUX</label>
        </div>
      </div>
    </div>
    <div class="ctrls" style="margin-top:10px">
      <button class="btn" id="gen">Generate set</button>
      <button class="btn" id="reshuffle">Reshuffle</button>
      <button class="btn" id="clear">Clear</button>
      <button class="btn" id="print">Print</button>
      <span class="right linkbox" id="sharebox">Share link will appear here after you generate…</span>
    </div>
  </section>

  <section id="viewer" class="panel">
    <div class="head">
      <button class="btn" id="prev">⟵ Prev</button>
      <div id="title" style="font-weight:700"></div>
      <span id="tag" class="pill"></span>
      <a class="btn" id="open" target="_blank" rel="noopener">Open PDF</a>
      <span class="right note">If the box below looks blank, the PDF blocked embedding — click "Open PDF".</span>
    </div>
    <div id="stage"><iframe id="frame" title="Problem PDF viewer"></iframe></div>
  </section>

  <section id="out" class="set"></section>
  <div class="footer">Tip: Edit <code>problem-data</code> (below) to add more problems and page numbers. We only link to official PDFs.
  </div>
</div>

<!-- PROBLEM SEED: minimal demo; replace/extend safely. Add page numbers if known. -->
<script type="application/json" id="problem-data">{
  "problems": [
    {"id":"SMC-2024-Q1","source":"UKMT","contest":"SMC","year":2024,"num":1,"kind":"mc","paper":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC-2024-Paper.pdf","solutions":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC_2024_Solutions.pdf","page":1},
    {"id":"SMC-2024-Q7","source":"UKMT","contest":"SMC","year":2024,"num":7,"kind":"mc","paper":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC-2024-Paper.pdf","solutions":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC_2024_Solutions.pdf","page":3},
    {"id":"SMC-2024-Q15","source":"UKMT","contest":"SMC","year":2024,"num":15,"kind":"mc","paper":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC-2024-Paper.pdf","solutions":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC_2024_Solutions.pdf","page":6},
    {"id":"SMC-2024-Q22","source":"UKMT","contest":"SMC","year":2024,"num":22,"kind":"mc","paper":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC-2024-Paper.pdf","solutions":"https://ukmt.org.uk/wp-content/uploads/2024/10/SMC_2024_Solutions.pdf","page":9},

    {"id":"BMO1-2024-Q1","source":"UKMT","contest":"BMO1","year":2024,"num":1,"kind":"proof","paper":"https://ukmt.org.uk/wp-content/uploads/2024/11/BMO1-2024-Paper-1.pdf","page":1},
    {"id":"BMO1-2024-Q2","source":"UKMT","contest":"BMO1","year":2024,"num":2,"kind":"proof","paper":"https://ukmt.org.uk/wp-content/uploads/2024/11/BMO1-2024-Paper-1.pdf","page":1},
    {"id":"BMO1-2024-Q3","source":"UKMT","contest":"BMO1","year":2024,"num":3,"kind":"proof","paper":"https://ukmt.org.uk/wp-content/uploads/2024/11/BMO1-2024-Paper-1.pdf","page":2},

    {"id":"CRUX-46-2-P1","source":"CRUX","contest":"CRUX","year":2020,"num":1,"kind":"proof","paper":"https://cms.math.ca/wp-content/uploads/2020/02/CRUXv46n2.pdf"},
    {"id":"CRUX-46-2-P2","source":"CRUX","contest":"CRUX","year":2020,"num":2,"kind":"proof","paper":"https://cms.math.ca/wp-content/uploads/2020/02/CRUXv46n2.pdf"}
  ]
}
</script>

<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const data = JSON.parse($('#problem-data').textContent).problems;
  let current = []; let idx = 0;

  function diffScore(p){
    if(p.kind==='mc'){
      const n = +p.num || 1; const max = (p.contest==='JMC'||p.contest==='IMC'||p.contest==='SMC')?25:25;
      return n/max;
    }
    const n = +p.num || 1; return Math.min(n,6)/6;
  }
  function bucket(p){ const d=diffScore(p); if(d<.34) return 'E'; if(d<.67) return 'M'; return 'H'; }
  function choose(list,k){ const a=list.slice(); for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a.slice(0,Math.min(k,a.length)); }

  function filterPool(){
    const count= +$('#count').value||8;
    const mix = $('#mix').value;
    const srcs=[...document.querySelectorAll('.src:checked')].map(x=>x.value);
    const kinds=[...document.querySelectorAll('.kind:checked')].map(x=>x.value);
    const cts=[...document.querySelectorAll('.ct:checked')].map(x=>x.value);
    let pool = data.filter(p=>srcs.includes(p.source) && kinds.includes(p.kind) && cts.includes(p.contest));
    return {pool,count,mix};
  }

  function pickSet(pool,count,mix){
    if(mix==='pureRandom') return choose(pool,count);
    const weights = {balanced:{E:.4,M:.4,H:.2}, easy:{E:.6,M:.3,H:.1}, hard:{E:.15,M:.45,H:.4}}[mix]||{E:.4,M:.4,H:.2};
    const buckets={E:pool.filter(p=>bucket(p)==='E'), M:pool.filter(p=>bucket(p)==='M'), H:pool.filter(p=>bucket(p)==='H')};
    const want={E:Math.round(count*weights.E), M:Math.round(count*weights.M)}; want.H=count-want.E-want.M;
    let chosen=[]; for(const k of ['E','M','H']) chosen = chosen.concat(choose(buckets[k], want[k]));
    if(chosen.length<count){ const rest=pool.filter(p=>!chosen.includes(p)); chosen=chosen.concat(choose(rest, count-chosen.length)); }
    return chosen;
  }

  function renderList(items){
    const out=$('#out');
    if(!items.length){ out.innerHTML='<div class="sub">No problems match your filters yet. Add more entries to the problem-data block.</div>'; return; }
    out.innerHTML = items.map((p,i)=>{
      const lab=`${i+1}. ${p.source} · ${p.contest} ${p.year} · Q${p.num}`;
      const tag=`<span class="pill">${bucket(p)}</span>`;
      const href = (p.page? `${p.paper}#page=${p.page}`: p.paper);
      const sol = p.solutions? `<a class="pill" target="_blank" rel="noopener" href="${p.solutions}">solutions</a>`:'';
      return `<article class="card"><div class="row"><strong>${lab}</strong> ${tag} <span class="meta">(${p.kind==='mc'?'multiple‑choice':'proof'})</span></div>
      <div class="row" style="margin-top:6px">
        <button class="btn" data-idx="${i}">View inline</button>
        <a class="btn" target="_blank" rel="noopener" href="${href}">Open PDF</a>
        ${sol}
      </div></article>`;
    }).join('');
    out.querySelectorAll('button[data-idx]').forEach(btn=>btn.addEventListener('click', (e)=>{
      const i = +e.currentTarget.getAttribute('data-idx');
      jump(i);
      window.scrollTo({top: $('#viewer').getBoundingClientRect().top + window.scrollY - 10, behavior:'smooth'});
    }));
  }

  function setViewer(p){
    $('#title').textContent = `${p.source} · ${p.contest} ${p.year} · Q${p.num}`;
    $('#tag').textContent = bucket(p);
    const page = p.page? `#page=${p.page}&zoom=page-fit` : '';
    const url = `${p.paper}${page}`;
    $('#open').href = url;
    $('#frame').src = url;
  }

  function jump(i){ if(!current.length) return; idx = (i+current.length)%current.length; setViewer(current[idx]); }

  function generate(){
    const {pool,count,mix} = filterPool();
    current = pickSet(pool,count,mix);
    idx = 0; if(current.length) setViewer(current[0]);
    renderList(current);
    updateShare(current);
  }

  function toSharePayload(items){ const ids=items.map(p=>p.id); return btoa(unescape(encodeURIComponent(JSON.stringify({ids})))); }
  function fromSharePayload(h){ try{const j=JSON.parse(decodeURIComponent(escape(atob(h)))); return j.ids||[]}catch(e){return []} }
  function updateShare(items){ const hash=toSharePayload(items); const url=location.origin+location.pathname+'#set='+hash; const box=$('#sharebox'); box.textContent=url; box.onclick=()=>navigator.clipboard.writeText(url); }
  function loadFromHash(){ const m=/#set=([A-Za-z0-9+/=\-_]+)/.exec(location.hash||''); if(!m) return false; const ids=fromSharePayload(m[1]); const items=ids.map(id=>data.find(p=>p.id===id)).filter(Boolean); if(items.length){ current=items; idx=0; setViewer(current[0]); renderList(current); updateShare(current); return true } return false }

  // wire up
  $('#gen').addEventListener('click', generate);
  $('#reshuffle').addEventListener('click', generate);
  $('#clear').addEventListener('click', ()=>{ location.hash=''; current=[]; $('#out').innerHTML=''; $('#sharebox').textContent='Share link will appear here after you generate…'; $('#frame').src='about:blank'; $('#title').textContent=''; $('#tag').textContent=''; $('#open').removeAttribute('href');});
  $('#print').addEventListener('click', ()=>window.print());
  $('#prev').addEventListener('click', ()=>jump(idx-1));
  document.addEventListener('keydown', (e)=>{ if(e.key==='ArrowLeft') jump(idx-1); if(e.key==='ArrowRight') jump(idx+1); });

  if(!loadFromHash()) generate();
})();
</script>
</body>
</html>
</body>
</html>
